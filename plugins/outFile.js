const XLSX=require("xlsx"),fs=require("fs").promises;function saveTextToFile(e,t){return new Promise(((s,o)=>{fs.writeFile(t,e,(e=>{e?o(e):s()}))}))}function appendToExcel(e,t,s){const o=XLSX.readFile(e);if(o.Sheets[t]){const e=o.Sheets[t];let l=1;for(let t in e)if(t.startsWith("A")){const e=XLSX.utils.decode_cell(t).r;e>=l&&(l=e+1)}s.forEach(((t,s)=>{t.forEach(((t,o)=>{const i=XLSX.utils.encode_cell({r:l+s,c:o});e[i]={t:"s",v:t}}))})),e["!ref"]||(e["!ref"]="A1");const i=XLSX.utils.decode_range(e["!ref"]);e["!ref"]=XLSX.utils.encode_range({s:{r:i.s.r,c:i.s.c},e:{r:l+s.length-1,c:i.e.c}})}else{const e=XLSX.utils.aoa_to_sheet(s);o.Sheets[t]=e,o.SheetNames.includes(t)||o.SheetNames.push(t)}XLSX.writeFile(o,e)}function createExcelFile(e,t,s){const o=XLSX.utils.book_new(),l=XLSX.utils.aoa_to_sheet(e);l["!ref"]=XLSX.utils.encode_range({s:{r:0,c:0},e:{r:e.length-1,c:e[0].length-1}}),XLSX.utils.book_append_sheet(o,l,s),XLSX.writeFile(o,t),console.log(`新Excel文件已创建：${t}`)}function worksheetExists(e,t){const s=e.SheetNames;for(let e=0;e<s.length;e++)if(s[e]===t)return!0;return!1}function appendWorksheetToFile(e,t,s,o){const l=XLSX.readFile(e),i=XLSX.utils.aoa_to_sheet(o);XLSX.utils.book_append_sheet(l,i,s);const r=XLSX.write(l,{bookType:"xlsx",type:"buffer"});fs.writeFile(t,r,"binary",(function(e){if(e)throw e;console.log(`新的工作表已追加到文件：${t}`)}))}module.exports={saveTextToFile:saveTextToFile,appendToExcel:appendToExcel,createExcelFile:createExcelFile,worksheetExists:worksheetExists,appendWorksheetToFile:appendWorksheetToFile};