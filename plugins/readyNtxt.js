const fs=require("fs").promises,path=require("path"),calculateProcessTime=require("./calculateTime");let readFiles=new Set;async function readFileContent(e,t){try{const a=await fs.readFile(e,"utf8");readFiles.add(e,t);const r=/\\([^\\]*?)(?=\.txt$)/,n=e.match(r)[1];return console.log("完成第"+t|"问题读取！个文件读取,",n),{data:a,email:n}}catch(t){throw console.error(`Error reading file ${e}:`,t),t}}let conuts=0;async function getNewTxtFilePath(e){try{const t=(await fs.readdir(e,{withFileTypes:!0})).filter((t=>t.isFile()&&t.name.endsWith(".txt")&&!readFiles.has(path.join(e,t.name)))).map((t=>path.join(e,t.name)));return console.log("一共还有",t.length||t.length,"个文件等待处理！大概还需:",calculateProcessTime(t.length)),t.length>0?(conuts++,t[0]):(console.log("全部文本处理完毕,共计:",conuts,"个Txt文件。"),"")}catch(e){throw console.error("Error getting new txt file path:",e),e}}module.exports={readFileContent:readFileContent,getNewTxtFilePath:getNewTxtFilePath};