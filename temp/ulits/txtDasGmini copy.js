const fileProcessor=require("../plugins/readyNtxt.js"),directoryPath="./dataIn/待处理TXT",moveFile=require("../plugins/removeFile.js"),fs=require("fs"),{qusetionRes:qusetionRes}=require("../qusetionTxt.js"),moment=require("moment"),path=require("path"),generateLog=require("../plugins/logger.js"),logFilePath=path.join(__dirname,"./log/appRun.log"),message="This is system log,下面是本次系统运行日志：";generateLog(logFilePath,message);const generateContent=require("../Gmini.js"),moveFiles=require("../plugins/fileMover.js"),sourceDir="./outExe/GminiResData",targetDir="./outExe/lastRunDataBackup";moveFiles(sourceDir,targetDir).then((()=>{console.log("所有文件成功移动到目标目录")})).catch((e=>{console.error("发生错误:",e)}));var filterString=require("../plugins/filterString.js");const{createExcelFile:createExcelFile,appendToExcel:appendToExcel}=require("../outFile.js");var resData=[],resError=[],resOther=[];function delay(e){return console.log("延时",e,"毫秒"),new Promise((r=>setTimeout(r,e)))}async function processTxtFiles(e){e=1;try{let o;do{if(o=await fileProcessor.getNewTxtFilePath(directoryPath),console.log("filePath:",o),""!==o&&null!==o){const i=await qusetionRes(),s=await fileProcessor.readFileContent(o,e);var r='"'+s.data+'"'+i,t="";try{const o=await generateContent(r);t=JSON.stringify(o),handleResult(s,o,t,e)}catch(e){console.error("API调用错误:",e)}finally{console.log("完成第",e,"个TXT文件处理,模型是:","GminiChatV1.5"),e++}}else console.log("TXT文件内容为空或已处理完！"),generateLog(logFilePath,"文件处理完！共计:"+(e-1)+"个。");await delay(3e3)}while(o)}catch(e){console.error("发生错误:",e),generateLog(logFilePath,e)}}processTxtFiles();