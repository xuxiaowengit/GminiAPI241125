const XLSX=require("xlsx"),fs=require("fs").promises;function saveTextToFile(e,t){return new Promise(((s,o)=>{fs.writeFile(t,e,(e=>{e?o(e):s()}))}))}function appendToExcel(e,t,s){var o=XLSX.readFile(e);if(o.Sheets[t]){const e=o.Sheets[t];let i=1;for(var r in e)r.startsWith("A")&&(r=XLSX.utils.decode_cell(r).r)>=i&&(i=r+1);s.forEach(((t,s)=>{t.forEach(((t,o)=>{o=XLSX.utils.encode_cell({r:i+s,c:o}),e[o]={t:"s",v:t}}))})),e["!ref"]||(e["!ref"]="A1");var l=XLSX.utils.decode_range(e["!ref"]);e["!ref"]=XLSX.utils.encode_range({s:{r:l.s.r,c:l.s.c},e:{r:i+s.length-1,c:l.e.c}})}else l=XLSX.utils.aoa_to_sheet(s),o.Sheets[t]=l,o.SheetNames.includes(t)||o.SheetNames.push(t);XLSX.writeFile(o,e)}function createExcelFile(e,t,s){var o=XLSX.utils.book_new(),r=XLSX.utils.aoa_to_sheet(e);r["!ref"]=XLSX.utils.encode_range({s:{r:0,c:0},e:{r:e.length-1,c:e[0].length-1}}),XLSX.utils.book_append_sheet(o,r,s),XLSX.writeFile(o,t),console.log("新Excel文件已创建："+t)}function worksheetExists(e,t){var s=e.SheetNames;for(let e=0;e<s.length;e++)if(s[e]===t)return!0;return!1}function appendWorksheetToFile(e,t,s,o){e=XLSX.readFile(e),o=XLSX.utils.aoa_to_sheet(o),XLSX.utils.book_append_sheet(e,o,s),o=XLSX.write(e,{bookType:"xlsx",type:"buffer"}),fs.writeFile(t,o,"binary",(function(e){if(e)throw e;console.log("新的工作表已追加到文件："+t)}))}module.exports={saveTextToFile:saveTextToFile,appendToExcel:appendToExcel,createExcelFile:createExcelFile,worksheetExists:worksheetExists,appendWorksheetToFile:appendWorksheetToFile};